<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>BTRFS Guide - Basic Commands, Snapshots, and RAID - Chris Titus Tech | Technology Simplified</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="BTRFS Guide - Basic Commands, Snapshots, and RAID" />
<meta property="og:description" content="This guide goes over everything you need to know to get started on BTRFS. With that said we will be going over the basic structure of BTRFS and the things you should and should not do." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.christitus.com/btrfs-guide/" />
<meta property="article:published_time" content="2020-01-13T16:36:18-06:00" />
<meta property="article:modified_time" content="2020-01-13T16:36:18-06:00" />

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="BTRFS Guide - Basic Commands, Snapshots, and RAID"/>
<meta name="twitter:description" content="This guide goes over everything you need to know to get started on BTRFS. With that said we will be going over the basic structure of BTRFS and the things you should and should not do."/>

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-5817718-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	<script data-ad-client="ca-pub-6679678361432308" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Chris Titus Tech | Technology Simplified" rel="home">
				<div class="logo__title"><img src="/images/logo.png" align="left"></div>
				<div class="logo__tagline">Tech Guides, Solutions, and Support</div>
			</a>
		</div>				
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				<i class='fa fa-heart'></i>
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="https://www.patreon.com/christitustech">
				<i class='fa fa-road'></i>
				<span class="menu__text">Donate</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/recommendations/">
				
				<span class="menu__text">Recommendations</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="https://download.teamviewer.com/download/TeamViewerQS.exe">
				<i class='fa fa-road'></i>
				<span class="menu__text">Remote Support</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/search/">
				<i class='fa fa-search'></i>
				<span class="menu__text">Search</span>
				
			</a>
		</li>
	</ul>
</nav>

		
	</div>
</header>

		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BTRFS Guide - Basic Commands, Snapshots, and RAID</h1>
			<div id="breadcrumbs" style="font-size:12px;">
    <a href="/">Home</a>
    
        
    
        
            / <a href=">>btrfs-guide">Btrfs guide</a>
        
    
        
    
</div>

			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2020-01-13T16:36:18">2020-01-13</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/linux/" rel="category">Linux</a>
	</span>
</div></div>
		</header>
		<figure class="post__thumbnail">
			<img src="/images/2020-thumbs/btrfs-guide.jpg" alt="BTRFS Guide - Basic Commands, Snapshots, and RAID">
		</figure>
<div class="post__toc toc">
	<div class="toc__title">

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left; 
height: 36px; 
width: 32px; 
float: left; 
text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: silver;">Share on: </span><div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https:\/\/www.christitus.com\/btrfs-guide\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=https:\/\/www.christitus.com\/btrfs-guide\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https:\/\/www.christitus.com\/btrfs-guide\/&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>

<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https:\/\/www.christitus.com\/btrfs-guide\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>
</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#creating-a-btrfs-filesystem">Creating a BTRFS Filesystem</a></li>
    <li><a href="#basic-commands">Basic Commands</a></li>
    <li><a href="#snapshots">Snapshots</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#multiple-disks-and-raid">Multiple disks and RAID</a></li>
    <li><a href="#video-walkthrough">Video Walkthrough</a></li>
  </ul>
</nav>
	</div>
</div>

<div class="content post__content clearfix">
			<p>This guide goes over everything you need to know to get started on BTRFS. With that said we will be going over the basic structure of BTRFS and the things you should and should not do.</p>
<h2 id="creating-a-btrfs-filesystem">Creating a BTRFS Filesystem</h2>
<p>Create the file system on an empty btrfs partition</p>
<blockquote>
<p><code>mkfs.btrfs /dev/sda1</code><br>
<em>Note: You will need to mount this file system after</em></p>
</blockquote>
<p>Now we need to make a subvolume <em>before</em> we add data to the device</p>
<blockquote>
<p><code>btrfs subvolume create /mnt/sda1</code> <em>/mnt/sda1 is the mount point!</em></p>
</blockquote>
<p>After this is complete you can now write data to your BTRFS volume and use all it capabilities.</p>
<p>Basic BTRFS Layout<br>
<em>Note: Top Level 5 is root and isn&rsquo;t a btrfs subvolume that can do snapshots and other btrfs features and therefore should not be mounted</em></p>
<pre><code>toplevel root level 5
  +-- root\@ level 256 (subvolume root mounted at / id varies)
  +-- root\.snapshots level 256 (typical snapshot subvolume)
</code></pre><h2 id="basic-commands">Basic Commands</h2>
<ul>
<li>Disk free<br>
<code>sudo btrfs fi show</code></li>
</ul>
<blockquote>
<p>Output:<br>
<img src="/images/2020/btrfs/fishow.png" alt="File System Output"></p>
</blockquote>
<ul>
<li>Disk Usage<br>
<code>sudo btrfs fi du /</code> <em>Note: you can make / any other mount point</em></li>
<li>Scrub SubVolume <em>Recommended running every week!</em><br>
<code>sudo btrfs scrub start /</code></li>
<li>Balance Subvolume for Performance<br>
<code>sudo btrfs balance start -musage=50 -dusage=50 /</code><br>
<em>Note: Use the musgae and dusage filters to only balance used blocks above 50 percent utilization</em><br>
<code>sudo btrfs balance cancel /</code> <em>Stops running balance</em></li>
<li>List Subvolumes <em>based on mountpoint</em><br>
<code>sudo btrfs subv list /home</code></li>
</ul>
<blockquote>
<p>Output:<br>
<img src="/images/2020/btrfs/subv-list.png" alt="Subvolume Output"></p>
</blockquote>
<ul>
<li>Mount Subvolume<br>
<code>sudo mount -o subvolid=267 /dev/sda1 /media/games</code><br>
<em>OR add this to</em> <code>/etc/fstab</code><br>
<code>UUID=IDGOESHERE /media/games rw,exec,subvolid=267 0 0</code></li>
</ul>
<h2 id="snapshots">Snapshots</h2>
<p>Snapshots are one of the best things about BTRFS and I absolutely love them. They are incredible powerful and beneficial.</p>
<p>So Lets run through some scenarios when you use Snapshots.</p>
<h4 id="create-snapshot">Create Snapshot</h4>
<blockquote>
<p><code>sudo btrfs subv snapshop /home /home/.snapshots/2020-01-13</code></p>
</blockquote>
<p>Using this you can revert the snapshop by simply editing the <code>/etc/fstab</code> and changing the subvol=2020-01-13 or the corresponding subvolid you get from <code>sudo btrfs subv list /home</code></p>
<h4 id="restore-snapshot">Restore Snapshot</h4>
<p>Restore Snapshop after reboot and successful rollback</p>
<blockquote>
<p><code>sudo btrfs subv delete /home</code><br>
<code>sudo btrfs subv snapshot /home/.snapshots/2020-01-13 /home</code></p>
</blockquote>
<p>Now simply restore your fstab and reboot to be back on the /home subvolume.</p>
<p>The reason to do it using this method is to verify the data first. If it doesn&rsquo;t work out you can simply change the <code>/etc/fstab</code> back and you will be back to where you started.</p>
<h2 id="multiple-disks-and-raid">Multiple disks and RAID</h2>
<p>Oh boy, here we go. This is such a badly misunderstood subject and if you aren&rsquo;t careful you will be causing more problems than you are looking to solve. So with that let&rsquo;s get into RAID. I will <em>NOT</em> be cover RAID 5 as it is <em>unstable</em> and SHOULD NOT BE USED!</p>
<p>Must know commands for multiple disks:</p>
<blockquote>
<p>Add Disks before creating subvolume: <code>sudo btrfs device add /dev/sda1 /dev/sdb1</code><br>
Add Disk to existing subvolume: <code>sudo btrfs device add /dev/sdb1 /home</code><br>
Delete Disk from subvolume: <code>sudo btrfs device delete /dev/sdb1 /home</code></p>
</blockquote>
<p>Creating the RAID File System:</p>
<blockquote>
<p>RAID 1: <code>sudo btrfs -m raid1 -d raid1 /dev/sda1 /dev/sdb1</code><br>
RAID 10: <code>sudo btrfs -m raid10 -d raid10 /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1</code></p>
</blockquote>
<p>Convert to to RAID 1 after adding disk to existing subvolume</p>
<blockquote>
<p><code>btrfs balance start -mconvert=raid1 -dconvert=raid1 /home</code></p>
</blockquote>
<p>I could put RAID 0 here&hellip; but honestly you should just use EXT4 or XFS if you are looking for performance. It would be better than using BTRFS!</p>
<h2 id="video-walkthrough">Video Walkthrough</h2>
<p><a href="https://www.youtube.com/watch?v=J2QP4onqJKI"><img src="https://img.youtube.com/vi/J2QP4onqJKI/0.jpg" alt="btrfs guide"></a><br>
<em>Note: YouTube Video - Hold Ctrl + Left Click to open in new window</em></p>
<p>I live stream on <a href="https://twitch.tv/christitustech">Twitch</a> and encourage you to drop in and ask a question. I regularly publish on <a href="https://www.youtube.com/c/ChrisTitusTech">YouTube</a> and <a href="https://www.christitus.com/">christitus.com</a>, but if you need immediate assistance, check out our discord channel at <a href="https://www.christitus.com/discord">Chris Titus Tech Discord</a>.</p>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/btrfs/" rel="tag">BTRFS</a></li>
	</ul>
</div>

		</footer>
		<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 56,
  backgroundColor: 'rgb(255, 82, 82)',
  textColor: '#fff'
})</script>

	</article>
</main>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/hugo-guide/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">Hugo Static Site Guide</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/lcars-screensaver/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">Lcars Screensaver</p></a>
	</div>
</nav>



			</div>
			
		</div>
		
		<footer class="footer">
	<div class="container footer__container flex">
		

		<div class="footer__copyright">
			&copy; 2020 Chris Titus.
			 - <a href="/terms-of-service/">Terms of Service</a>
			 - <a href="/privacy-policy/">Privacy Policy</a>
		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>
